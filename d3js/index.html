<!DOCTYPE html>
<html>

<head>
    <title>Life Expectancy Map</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    <style>
        .tooltip {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            padding: 5px;
            pointer-events: none;
        }

        .country {
            stroke: #fff;
            stroke-width: 0.5;
        }

        .country:hover {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>
        // Step 1: Set up dimensions and SVG
        const width = 960;
        const height = 500;
        const svg = d3.select("#map")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Step 2: Create a tooltip
        const tooltip = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // Step 3: Set up the map projection
        const projection = d3.geoMercator()
            .scale(120)
            .translate([width / 2, height / 1.5]);
        const path = d3.geoPath().projection(projection);

        // Step 4: Create sample life expectancy data
        const lifeExpectancyData = {
            "USA": 78.5,
            "CAN": 82.2,
            "GBR": 81.3,
            "FRA": 82.5,
            "DEU": 81.1,
            "JPN": 84.2,
            "AUS": 83.2,
            "BRA": 75.9,
            "RUS": 72.4,
            "IND": 69.7,
            "CHN": 76.9,
            // Add more countries as needed
        };

        // Step 5: Create color scale
        const colorScale = d3.scaleSequential()
            .domain([60, 85])  // Life expectancy range
            .interpolator(d3.interpolateYlOrRd);

        // Step 6: Load and display the world map with data
        d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")
            .then(function (world) {
                const countries = topojson.feature(world, world.objects.countries);

                // Step 7: Draw countries and add interactivity
                svg.selectAll("path")
                    .data(countries.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .attr("class", "country")
                    .style("fill", d => {
                        // Get country code and corresponding life expectancy
                        const value = lifeExpectancyData[d.id];
                        return value ? colorScale(value) : "#ccc";
                    })
                    .on("mouseover", function (event, d) {
                        const value = lifeExpectancyData[d.id];
                        tooltip.transition()
                            .duration(200)
                            .style("opacity", .9);
                        tooltip.html(`Country: ${d.properties.name}<br/>Life Expectancy: ${value ? value.toFixed(1) : "No data"}`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", function () {
                        tooltip.transition()
                            .duration(500)
                            .style("opacity", 0);
                    });

                // Step 8: Add a legend
                const legendWidth = 200;
                const legendHeight = 10;
                const legend = svg.append("g")
                    .attr("transform", `translate(${width - legendWidth - 20}, ${height - 50})`);

                const legendScale = d3.scaleLinear()
                    .domain([60, 85])
                    .range([0, legendWidth]);

                const legendAxis = d3.axisBottom(legendScale)
                    .ticks(5);

                legend.append("g")
                    .call(legendAxis);

                const gradientData = d3.range(60, 85, 0.1);
                legend.selectAll("rect")
                    .data(gradientData)
                    .enter()
                    .append("rect")
                    .attr("x", d => legendScale(d))
                    .attr("y", -legendHeight)
                    .attr("width", legendWidth / gradientData.length)
                    .attr("height", legendHeight)
                    .style("fill", d => colorScale(d));
            });
    </script>
</body>

</html>